<script>
//npm install --save formiojs
let json = "";
let formBuilder = {};
let form = {
    "components": [
        {
            "label": "Date / Time",
            "labelPosition": "top",
            "displayInTimezone": "viewer",
            "useLocaleSettings": false,
            "allowInput": true,
            "format": "yyyy-MM-dd",
            "placeholder": "",
            "description": "",
            "tooltip": "",
            "customClass": "",
            "tabindex": "",
            "hidden": false,
            "hideLabel": true,
            "autofocus": true,
            "disabled": false,
            "tableView": false,
            "modalEdit": false,
            "enableDate": true,
            "enableMinDateInput": false,
            "datePicker": {
                "minDate": null,
                "maxDate": null,
                "disable": "",
                "disableFunction": "",
                "disableWeekends": false,
                "disableWeekdays": false,
                "showWeeks": true,
                "startingDay": 0,
                "initDate": "",
                "minMode": "day",
                "maxMode": "year",
                "yearRows": 4,
                "yearColumns": 5
            },
            "enableMaxDateInput": false,
            "enableTime": false,
            "timePicker": {
                "showMeridian": true,
                "hourStep": 1,
                "minuteStep": 1,
                "readonlyInput": false,
                "mousewheel": true,
                "arrowkeys": true
            },
            "multiple": false,
            "defaultValue": "",
            "defaultDate": "",
            "customOptions": {},
            "persistent": true,
            "protected": false,
            "dbIndex": false,
            "encrypted": false,
            "redrawOn": "",
            "clearOnHide": true,
            "customDefaultValue": "",
            "calculateValue": "",
            "calculateServer": false,
            "allowCalculateOverride": false,
            "validate": {
                "required": false,
                "customMessage": "",
                "custom": "",
                "customPrivate": false,
                "json": "",
                "strictDateValidation": false,
                "multiple": false,
                "unique": false
            },
            "unique": false,
            "validateOn": "change",
            "errorLabel": "",
            "key": "dateTime",
            "tags": [],
            "properties": {},
            "conditional": {
                "show": null,
                "when": null,
                "eq": "",
                "json": ""
            },
            "customConditional": "",
            "logic": [],
            "attributes": {},
            "overlay": {
                "style": "",
                "page": "",
                "left": "",
                "top": "",
                "width": "",
                "height": ""
            },
            "type": "datetime",
            "timezone": "",
            "input": true,
            "widget": {
                "type": "calendar",
                "displayInTimezone": "viewer",
                "language": "en",
                "useLocaleSettings": false,
                "allowInput": true,
                "mode": "single",
                "enableTime": false,
                "noCalendar": false,
                "format": "yyyy-MM-dd",
                "hourIncrement": 1,
                "minuteIncrement": 1,
                "time_24hr": false,
                "minDate": null,
                "disabledDates": "",
                "disableWeekends": false,
                "disableWeekdays": false,
                "disableFunction": "",
                "maxDate": null
            },
            "prefix": "",
            "suffix": {},
            "refreshOn": "",
            "showCharCount": false,
            "showWordCount": false,
            "allowMultipleMasks": false,
            "datepickerMode": "day",
            "id": "evzq05"
        },
        {
            "label": "Time",
            "labelPosition": "top",
            "inputType": "time",
            "description": "",
            "tooltip": "",
            "customClass": "",
            "tabindex": "",
            "hidden": false,
            "hideLabel": true,
            "autofocus": false,
            "disabled": false,
            "tableView": true,
            "modalEdit": false,
            "multiple": false,
            "dataFormat": "HH:mm:ss",
            "persistent": true,
            "protected": false,
            "dbIndex": false,
            "encrypted": false,
            "redrawOn": "",
            "clearOnHide": true,
            "customDefaultValue": "",
            "calculateValue": "",
            "calculateServer": false,
            "allowCalculateOverride": false,
            "validate": {
                "required": false,
                "customMessage": "",
                "custom": "",
                "customPrivate": false,
                "json": "",
                "strictDateValidation": false,
                "multiple": false,
                "unique": false,
                "minLength": "",
                "maxLength": "",
                "pattern": ""
            },
            "unique": false,
            "validateOn": "change",
            "errorLabel": "",
            "key": "time",
            "tags": [],
            "properties": {},
            "conditional": {
                "show": null,
                "when": null,
                "eq": "",
                "json": ""
            },
            "customConditional": "",
            "logic": [],
            "attributes": {},
            "overlay": {
                "style": "",
                "page": "",
                "left": "",
                "top": "",
                "width": "",
                "height": ""
            },
            "type": "time",
            "format": "HH:mm",
            "input": true,
            "placeholder": "",
            "prefix": "",
            "suffix": "",
            "refreshOn": "",
            "widget": {
                "type": "input"
            },
            "showCharCount": false,
            "showWordCount": false,
            "allowMultipleMasks": false,
            "mask": false,
            "inputFormat": "plain",
            "inputMask": "99:99",
            "spellcheck": true,
            "id": "e9cz8oi",
            "defaultValue": ""
        },
        {
            "label": "Select",
            "labelPosition": "top",
            "widget": "choicesjs",
            "placeholder": "Record Type",
            "description": "",
            "tooltip": "",
            "customClass": "",
            "tabindex": "",
            "hidden": false,
            "hideLabel": true,
            "uniqueOptions": false,
            "autofocus": false,
            "disabled": false,
            "tableView": true,
            "modalEdit": false,
            "multiple": false,
            "dataSrc": "values",
            "data": {
                "values": [
                    {
                        "label": "Food",
                        "value": "FOOD"
                    },
                    {
                        "label": "Drugs",
                        "value": "DRUG"
                    },
                    {
                        "label": "Glucose",
                        "value": "GLUC"
                    },
                    {
                        "label": "Exercise",
                        "value": "EXE"
                    },
                    {
                        "label": "Weight",
                        "value": "WGT"
                    },
                    {
                        "label": "Pressure",
                        "value": "PRESS"
                    }
                ],
                "resource": "",
                "json": "",
                "url": "",
                "custom": ""
            },
            "valueProperty": "",
            "dataType": "",
            "template": "<span>{{ item.label }}</span>",
            "refreshOn": "",
            "clearOnRefresh": false,
            "searchEnabled": true,
            "selectThreshold": 0.3,
            "readOnlyValue": false,
            "customOptions": {},
            "persistent": true,
            "protected": false,
            "dbIndex": false,
            "encrypted": false,
            "clearOnHide": true,
            "customDefaultValue": "",
            "calculateValue": "",
            "calculateServer": false,
            "allowCalculateOverride": false,
            "validateOn": "change",
            "validate": {
                "required": false,
                "customMessage": "",
                "custom": "",
                "customPrivate": false,
                "json": "",
                "strictDateValidation": false,
                "multiple": false,
                "unique": false
            },
            "unique": false,
            "errorLabel": "",
            "key": "select",
            "tags": [],
            "properties": {},
            "conditional": {
                "show": null,
                "when": null,
                "eq": "",
                "json": ""
            },
            "customConditional": "",
            "logic": [],
            "attributes": {},
            "overlay": {
                "style": "",
                "page": "",
                "left": "",
                "top": "",
                "width": "",
                "height": ""
            },
            "type": "select",
            "indexeddb": {
                "filter": {}
            },
            "selectFields": "",
            "searchField": "",
            "minSearch": 0,
            "filter": "",
            "limit": 100,
            "redrawOn": "",
            "input": true,
            "prefix": "",
            "suffix": "",
            "showCharCount": false,
            "showWordCount": false,
            "allowMultipleMasks": false,
            "lazyLoad": true,
            "authenticate": false,
            "searchThreshold": 0.3,
            "fuseOptions": {
                "include": "score",
                "threshold": 0.3
            },
            "id": "ex81bbk",
            "defaultValue": ""
        },
        {
            "legend": "Food",
            "tooltip": "",
            "customClass": "",
            "tabindex": "",
            "hidden": false,
            "disabled": false,
            "tableView": false,
            "modalEdit": false,
            "key": "fieldSet",
            "tags": [],
            "properties": {},
            "conditional": {
                "show": true,
                "when": "select",
                "eq": "FOOD",
                "json": ""
            },
            "customConditional": "",
            "logic": [],
            "attributes": {},
            "overlay": {
                "style": "",
                "page": "",
                "left": "",
                "top": "",
                "width": "",
                "height": ""
            },
            "type": "fieldset",
            "label": "Food",
            "input": false,
            "components": [
                {
                    "label": "Text Area",
                    "placeholder": "Food Items",
                    "autoExpand": false,
                    "tableView": true,
                    "key": "textArea",
                    "type": "textarea",
                    "input": true,
                    "prefix": "",
                    "customClass": "",
                    "suffix": "",
                    "multiple": false,
                    "defaultValue": null,
                    "protected": false,
                    "unique": false,
                    "persistent": true,
                    "hidden": false,
                    "clearOnHide": true,
                    "refreshOn": "",
                    "redrawOn": "",
                    "modalEdit": false,
                    "labelPosition": "top",
                    "description": "",
                    "errorLabel": "",
                    "tooltip": "",
                    "hideLabel": false,
                    "tabindex": "",
                    "disabled": false,
                    "autofocus": false,
                    "dbIndex": false,
                    "customDefaultValue": "",
                    "calculateValue": "",
                    "calculateServer": false,
                    "widget": {
                        "type": "input"
                    },
                    "attributes": {},
                    "validateOn": "change",
                    "validate": {
                        "required": false,
                        "custom": "",
                        "customPrivate": false,
                        "strictDateValidation": false,
                        "multiple": false,
                        "unique": false,
                        "minLength": "",
                        "maxLength": "",
                        "pattern": "",
                        "minWords": "",
                        "maxWords": ""
                    },
                    "conditional": {
                        "show": null,
                        "when": null,
                        "eq": ""
                    },
                    "overlay": {
                        "style": "",
                        "left": "",
                        "top": "",
                        "width": "",
                        "height": ""
                    },
                    "allowCalculateOverride": false,
                    "encrypted": false,
                    "showCharCount": false,
                    "showWordCount": false,
                    "properties": {},
                    "allowMultipleMasks": false,
                    "mask": false,
                    "inputType": "text",
                    "inputFormat": "html",
                    "inputMask": "",
                    "spellcheck": true,
                    "rows": 3,
                    "wysiwyg": false,
                    "editor": "",
                    "fixedSize": true,
                    "id": "e86gsz"
                }
            ],
            "placeholder": "",
            "prefix": "",
            "suffix": "",
            "multiple": false,
            "defaultValue": null,
            "protected": false,
            "unique": false,
            "persistent": false,
            "clearOnHide": true,
            "refreshOn": "",
            "redrawOn": "",
            "labelPosition": "top",
            "description": "",
            "errorLabel": "",
            "hideLabel": false,
            "autofocus": false,
            "dbIndex": false,
            "customDefaultValue": "",
            "calculateValue": "",
            "calculateServer": false,
            "widget": null,
            "validateOn": "change",
            "validate": {
                "required": false,
                "custom": "",
                "customPrivate": false,
                "strictDateValidation": false,
                "multiple": false,
                "unique": false
            },
            "allowCalculateOverride": false,
            "encrypted": false,
            "showCharCount": false,
            "showWordCount": false,
            "allowMultipleMasks": false,
            "tree": false,
            "id": "exq9dx"
        },
        {
            "legend": "Glucose",
            "tooltip": "",
            "customClass": "",
            "tabindex": "",
            "hidden": false,
            "disabled": false,
            "tableView": false,
            "modalEdit": false,
            "key": "fieldSet1",
            "tags": [],
            "properties": {},
            "conditional": {
                "show": true,
                "when": "select",
                "eq": "GLUC",
                "json": ""
            },
            "customConditional": "",
            "logic": [],
            "attributes": {},
            "overlay": {
                "style": "",
                "page": "",
                "left": "",
                "top": "",
                "width": "",
                "height": ""
            },
            "type": "fieldset",
            "label": "Field Set",
            "input": false,
            "placeholder": "",
            "prefix": "",
            "suffix": "",
            "multiple": false,
            "defaultValue": null,
            "protected": false,
            "unique": false,
            "persistent": false,
            "clearOnHide": true,
            "refreshOn": "",
            "redrawOn": "",
            "labelPosition": "top",
            "description": "",
            "errorLabel": "",
            "hideLabel": false,
            "autofocus": false,
            "dbIndex": false,
            "customDefaultValue": "",
            "calculateValue": "",
            "calculateServer": false,
            "widget": null,
            "validateOn": "change",
            "validate": {
                "required": false,
                "custom": "",
                "customPrivate": false,
                "strictDateValidation": false,
                "multiple": false,
                "unique": false
            },
            "allowCalculateOverride": false,
            "encrypted": false,
            "showCharCount": false,
            "showWordCount": false,
            "allowMultipleMasks": false,
            "tree": false,
            "components": [
                {
                    "label": "Glucose",
                    "labelPosition": "top",
                    "placeholder": "Glucometer Read",
                    "description": "",
                    "tooltip": "",
                    "prefix": "",
                    "suffix": "",
                    "widget": {
                        "type": "input"
                    },
                    "customClass": "",
                    "tabindex": "",
                    "hidden": false,
                    "hideLabel": false,
                    "mask": false,
                    "autofocus": false,
                    "spellcheck": true,
                    "disabled": false,
                    "tableView": false,
                    "modalEdit": false,
                    "multiple": false,
                    "persistent": true,
                    "delimiter": false,
                    "requireDecimal": false,
                    "inputFormat": "plain",
                    "protected": false,
                    "dbIndex": false,
                    "encrypted": false,
                    "redrawOn": "",
                    "clearOnHide": true,
                    "customDefaultValue": "",
                    "calculateValue": "",
                    "calculateServer": false,
                    "allowCalculateOverride": false,
                    "validateOn": "change",
                    "validate": {
                        "required": false,
                        "customMessage": "",
                        "custom": "",
                        "customPrivate": false,
                        "json": "",
                        "min": 0,
                        "max": 300,
                        "strictDateValidation": false,
                        "multiple": false,
                        "unique": false,
                        "step": "any",
                        "integer": ""
                    },
                    "errorLabel": "Value out of range (0-300)",
                    "key": "glucose",
                    "tags": [],
                    "properties": {},
                    "conditional": {
                        "show": null,
                        "when": null,
                        "eq": "",
                        "json": ""
                    },
                    "customConditional": "",
                    "logic": [],
                    "attributes": {},
                    "overlay": {
                        "style": "",
                        "page": "",
                        "left": "",
                        "top": "",
                        "width": "",
                        "height": ""
                    },
                    "type": "number",
                    "input": true,
                    "unique": false,
                    "refreshOn": "",
                    "showCharCount": false,
                    "showWordCount": false,
                    "allowMultipleMasks": false,
                    "id": "edxq4rq",
                    "defaultValue": null
                }
            ],
            "id": "e0dmupt"
        },
        {
            "type": "button",
            "label": "Submit",
            "key": "submit",
            "size": "md",
            "block": false,
            "action": "submit",
            "disableOnInvalid": true,
            "theme": "primary",
            "input": true,
            "placeholder": "",
            "prefix": "",
            "customClass": "",
            "suffix": "",
            "multiple": false,
            "defaultValue": null,
            "protected": false,
            "unique": false,
            "persistent": false,
            "hidden": false,
            "clearOnHide": true,
            "refreshOn": "",
            "redrawOn": "",
            "tableView": false,
            "modalEdit": false,
            "labelPosition": "top",
            "description": "",
            "errorLabel": "",
            "tooltip": "",
            "hideLabel": false,
            "tabindex": "",
            "disabled": false,
            "autofocus": false,
            "dbIndex": false,
            "customDefaultValue": "",
            "calculateValue": "",
            "calculateServer": false,
            "widget": {
                "type": "input"
            },
            "attributes": {},
            "validateOn": "change",
            "validate": {
                "required": false,
                "custom": "",
                "customPrivate": false,
                "strictDateValidation": false,
                "multiple": false,
                "unique": false
            },
            "conditional": {
                "show": null,
                "when": null,
                "eq": ""
            },
            "overlay": {
                "style": "",
                "left": "",
                "top": "",
                "width": "",
                "height": ""
            },
            "allowCalculateOverride": false,
            "encrypted": false,
            "showCharCount": false,
            "showWordCount": false,
            "properties": {},
            "allowMultipleMasks": false,
            "leftIcon": "",
            "rightIcon": "",
            "dataGridLabel": true,
            "id": "ep936cl"
        }
    ]
}
function openBuilder()
{
    window.location = "builder.html";
}


function openForm(){
    window.location = "index.html";
}

function createBuilder(){
    Formio.builder(document.getElementById('builder'), formBuilder, {}).then(function(builder){
        builder.on('change',function(change){
          console.log(change);
          json = JSON.stringify(change, null, 4)
          var tx =  document.getElementById("result");
          tx.value = json;
          tx.select();
          document.execCommand("copy");
          //document.getElementById("result").value = json;
          console.log("json",json);
        })
      });
}

function importForm(){
    var tx =  document.getElementById("result").value;
    try
    {
        formBuilder = JSON.parse(tx);
        createBuilder();
    }
    catch(ex)
    {
        alert("Error parsing form\n" + ex);
    }
}





function onChange(event){
    alert("onchange");
    alert(event);
    this.jsonElement.nativeElement.innerHTML = '';
    this.jsonElement.nativeElement.appendChild(document.createTextNode(JSON.stringify(event.form, null, 4)));
  }


</script>